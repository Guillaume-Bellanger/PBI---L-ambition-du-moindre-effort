table __MESURES
	lineageTag: 995ed117-b399-46be-b965-987e4b3b5781

	measure KPI_Total_CO2_Mt_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles et pr√©c√©dentes
			VAR CO2_Actuel = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]))
			VAR CO2_Precedent =
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]),
			        FILTER(ALL(Dim_Temps), Dim_Temps[Ann√©e] = AnneePrec)
			    )
			
			//Variation %
			VAR Delta = DIVIDE(CO2_Actuel - CO2_Precedent, CO2_Precedent)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",         // pas de donn√©es
			        ABS(Delta) < 0.001, "#999999",     // stable
			        Delta < 0, "#5CB85C",              // baisse = vert
			        Delta > 0, "#E5690B",              // hausse = orange
			        "#999999"
			    )
			
			VAR VariationTexte =
			    IF(ISBLANK(Delta),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Bloc HTML final
			RETURN
			IF(
			    ISBLANK(Annee) || ISBLANK(CO2_Actuel),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:15px;'>" &
			    "üåç <b>" & FORMAT(CO2_Actuel, "#,##0") & " Mt</b> de CO‚ÇÇ √©mis en " & Annee & "<br>" &
			    VariationTexte &
			    "</div>"
			)
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: 3e7e38f1-13c2-4b62-90a9-ddae115ecab9

	measure KPI_CO2_per_capita_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles et pr√©c√©dentes
			VAR CO2_Actuel = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]) * 1000000)
			VAR Pop_Actuelle = CALCULATE(SUM(Fact_Emissions[Population]))
			VAR Ratio_Actuel = DIVIDE(CO2_Actuel, Pop_Actuelle)
			
			VAR CO2_Precedent =
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]) * 1000000,
			        FILTER(ALL(Dim_Temps), Dim_Temps[Ann√©e] = AnneePrec)
			    )
			
			VAR Pop_Precedente =
			    CALCULATE(
			        SUM(Fact_Emissions[Population]),
			        FILTER(ALL(Dim_Temps), Dim_Temps[Ann√©e] = AnneePrec)
			    )
			
			VAR Ratio_Precedent = DIVIDE(CO2_Precedent, Pop_Precedente)
			
			// Variation %
			VAR Delta = DIVIDE(Ratio_Actuel - Ratio_Precedent, Ratio_Precedent)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        ABS(Delta) < 0.001, "#999999",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			VAR EvolutionTexte =
			    IF(
			        ISBLANK(Ratio_Precedent),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Bloc final
			RETURN
			IF(
			    ISBLANK(Annee) || ISBLANK(Ratio_Actuel),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:15px;'>" &
			    "üë§ <b>" & FORMAT(Ratio_Actuel, "0.0") & " t/hab</b> de CO‚ÇÇ en " & Annee & "<br>" &
			    EvolutionTexte &
			    "</div>"
			)
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: fd5b625a-bc44-4f24-b6aa-9768b4869838

	measure KPI_Total_GES_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles et pr√©c√©dentes
			VAR GES_Actuel = CALCULATE(SUM(Fact_Emissions[GES_total_Mt]))
			VAR GES_Precedent =
			    CALCULATE(
			        SUM(Fact_Emissions[GES_total_Mt]),
			        FILTER(ALL(Dim_Temps), Dim_Temps[Ann√©e] = AnneePrec)
			    )
			
			// Variation %
			VAR Delta = DIVIDE(GES_Actuel - GES_Precedent, GES_Precedent)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        ABS(Delta) < 0.001, "#999999",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			VAR EvolutionTexte =
			    IF(ISBLANK(GES_Precedent),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Bloc HTML final
			RETURN
			IF(
			    ISBLANK(Annee) || ISBLANK(GES_Actuel),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:15px;'>" &
			    "‚òÅÔ∏è <b>" & FORMAT(GES_Actuel, "#,##0") & " Mt</b> de GES √©mis en " & Annee & "<br>" &
			    EvolutionTexte &
			    "</div>"
			)
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: 9fc9d529-523a-498f-9416-8d0a5cc48b85

	measure KPI_Peak_Emission_Year_HTML = ```
			
			VAR AnneePic = 
			    CALCULATE(
			        MAX(Dim_Temps[Ann√©e]),
			        TOPN(
			            1,
			            SUMMARIZE(
			                Fact_Emissions,
			                Dim_Temps[Ann√©e],
			                "TotalCO2", SUM(Fact_Emissions[CO2_total_Mt])
			            ),
			            [TotalCO2], DESC
			        )
			    )
			
			VAR TotalPic = 
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]),
			        Dim_Temps[Ann√©e] = AnneePic
			    )
			
			RETURN
			IF(
			    ISBLANK(AnneePic),
			    "<span style='color:#999999;'>Aucune donn√©e disponible</span>",
			    "<div style='font-family:Segoe UI; font-size:15px; text-align:left;'>" &
			    "üìÖ <b style='font-size:15px;'>" & AnneePic & "</b><br>" &
			    "<span style='color:#E5690B; font-weight:bold;'>üõë Record historique d‚Äô√©missions de CO‚ÇÇ</span><br>" &
			    "<span style='color:#264059;'>Total √©mis : " & FORMAT(TotalPic, "#,##0") & " millions de tonnes</span>" &
			    "</div>"
			)
			
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: e04cd143-b46e-4a16-a10c-51cd1e4183c9

	measure KPI_Classement_CO2_Pays_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			VAR NomPays = SELECTEDVALUE(Dim_Pays[Pays])
			
			// Table des pays avec leur total CO‚ÇÇ cette ann√©e-l√†
			VAR TableClassement =
			    FILTER(
			        ALL(Dim_Pays),
			        NOT ISBLANK(
			            CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Ann√©e] = Annee)
			        )
			    )
			
			// Classement du pays dans la table
			VAR Rang =
			    RANKX(
			        TableClassement,
			        CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Ann√©e] = Annee),
			        ,
			        DESC,
			        DENSE
			    )
			
			// Total pour le pays s√©lectionn√©
			VAR TotalMt =
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]),
			        Fact_Emissions[Ann√©e] = Annee,
			        Fact_Emissions[Code ISO] = CodePays
			    )
			
			VAR TotalTonnes = TotalMt * 1000000
			
			// Format dynamique : millions ou unit√©s
			VAR AffichageCO2 =
			    IF(
			        TotalTonnes >= 1000000,
			        FORMAT(TotalMt, "#,##0.0") & " millions de tonnes",
			        FORMAT(TotalTonnes, "#,##0") & " tonnes"
			    )
			
			RETURN
			IF(
			    ISBLANK(CodePays) || ISBLANK(Annee),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:15px;'>" &
			    "üåç <b>" & NomPays & "</b> √©tait le <b>" & Rang & "·µâ</b> pays le plus √©metteur de CO‚ÇÇ en " & Annee & "<br>" &
			    "<span style='color:#264059;'>√âmissions totales : <b>" & AffichageCO2 & "</b></span>" &
			    "</div>"
			)
			
			```
		displayFolder: Focus pays
		lineageTag: e63d74ae-e81a-4a20-93b3-1249037afd72

	measure KPI_CO2_par_Habitant_Pays_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			VAR AnneePrec = Annee - 1
			
			// CO2/hab ann√©e courante
			VAR CO2_Tonnes_Actuel =
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]) * 1000000,
			        Fact_Emissions[Ann√©e] = Annee,
			        Fact_Emissions[Code ISO] = CodePays
			    )
			
			VAR Pop_Actuelle =
			    CALCULATE(
			        SUM(Fact_Emissions[Population]),
			        Fact_Emissions[Ann√©e] = Annee,
			        Fact_Emissions[Code ISO] = CodePays
			    )
			
			VAR RatioActuel = DIVIDE(CO2_Tonnes_Actuel, Pop_Actuelle)
			
			// CO2/hab ann√©e pr√©c√©dente
			VAR CO2_Tonnes_Prec =
			    CALCULATE(
			        SUM(Fact_Emissions[CO2_total_Mt]) * 1000000,
			        REMOVEFILTERS(Dim_Temps),
			        Fact_Emissions[Ann√©e] = AnneePrec,
			        Fact_Emissions[Code ISO] = CodePays
			    )
			
			VAR Pop_Prec =
			    CALCULATE(
			        SUM(Fact_Emissions[Population]),
			        REMOVEFILTERS(Dim_Temps),
			        Fact_Emissions[Ann√©e] = AnneePrec,
			        Fact_Emissions[Code ISO] = CodePays
			    )
			
			VAR RatioPrec = DIVIDE(CO2_Tonnes_Prec, Pop_Prec)
			
			// Variation %
			VAR Delta = DIVIDE(RatioActuel - RatioPrec, RatioPrec)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        ABS(Delta) < 0.001, "#999999",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			VAR Texte_Evolution =
			    IF(
			        ISBLANK(RatioPrec),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Texte principal
			RETURN
			IF(
			    ISBLANK(RatioActuel),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:15px;'>" &
			    "üë§ <b>" & FORMAT(RatioActuel, "0.0") & " tonne" & IF(RatioActuel >= 2, "s", "") &
			    "</b> de CO‚ÇÇ par habitant en " & Annee & "<br>" &
			    Texte_Evolution &
			    "</div>"
			)
			
			```
		displayFolder: Focus pays
		lineageTag: 45dec693-5ba7-4059-b59a-5c06db6425d9

	measure KPI_Gaz_Dominant_Pays_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			
			// GES actuels
			VAR CO2 = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR CH4 = CALCULATE(SUM(Fact_Emissions[M√©thane_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR N2O = CALCULATE(SUM(Fact_Emissions[N2O_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR GES_Total = CO2 + CH4 + N2O
			
			VAR TableActuel =
			    UNION(
			        ROW("Gaz", "CO‚ÇÇ", "Valeur", CO2),
			        ROW("Gaz", "M√©thane", "Valeur", CH4),
			        ROW("Gaz", "N‚ÇÇO", "Valeur", N2O)
			    )
			
			VAR MaxGaz = MAXX(TableActuel, [Valeur])
			VAR GazActuel = MAXX(FILTER(TableActuel, [Valeur] = MaxGaz), [Gaz])
			VAR PartActuelle = DIVIDE(MaxGaz, GES_Total)
			
			// GES ann√©e pr√©c√©dente
			VAR CO2prec = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR CH4prec = CALCULATE(SUM(Fact_Emissions[M√©thane_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR N2Oprec = CALCULATE(SUM(Fact_Emissions[N2O_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR GES_Prec = CO2prec + CH4prec + N2Oprec
			
			VAR TablePrec =
			    UNION(
			        ROW("Gaz", "CO‚ÇÇ", "Valeur", CO2prec),
			        ROW("Gaz", "M√©thane", "Valeur", CH4prec),
			        ROW("Gaz", "N‚ÇÇO", "Valeur", N2Oprec)
			    )
			
			VAR MaxPrec = MAXX(TablePrec, [Valeur])
			VAR GazPrec = MAXX(FILTER(TablePrec, [Valeur] = MaxPrec), [Gaz])
			VAR PartPrec = DIVIDE(MaxPrec, GES_Prec)
			
			// Comparaison
			VAR MemeGaz = GazActuel = GazPrec
			VAR Delta = DIVIDE(PartActuelle - PartPrec, PartPrec)
			
			// Style dynamique
			VAR Signe = IF(ISBLANK(Delta), BLANK(), IF(Delta > 0, "+", "-"))
			VAR Fleche = IF(ISBLANK(Delta), "", IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì")))
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        NOT MemeGaz, "#9F5D35",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			// Variation texte
			VAR TexteVariation =
			    IF(
			        ISBLANK(GazPrec),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        IF(
			            MemeGaz,
			            "<br><span style='color:" & Couleur & "; font-weight:bold;'>" &
			            Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " de sa part par rapport √† " & AnneePrec & "</span>",
			            "<br><span style='color:" & Couleur & "; font-weight:bold;'>‚ö† Gaz dominant diff√©rent de " & AnneePrec & "</span>"
			        )
			    )
			
			// Affichage final
			RETURN
			IF(
			    ISBLANK(GazActuel) || ISBLANK(GES_Total),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:14px;'>" &
			    "üß™ Le gaz dominant √©mis par <b>" & Pays & "</b> en " & Annee & " est : <b>" & GazActuel & "</b><br>" &
			    "<span style='color:#264059;'>Il repr√©sente <b>" & FORMAT(PartActuelle, "0.0%") & "</b> des √©missions de GES</span>" &
			    TexteVariation &
			    "</div>"
			)
			
			```
		displayFolder: Focus pays
		lineageTag: 88eacfb0-bbe1-47e7-addb-a232bfc6de8e

	measure KPI_Secteur_Dominant_Pays_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			
			// Valeurs actuelles par secteur
			VAR Charbon = CALCULATE(SUM(Fact_Emissions[CO2_charbon_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR Petrole = CALCULATE(SUM(Fact_Emissions[CO2_p√©trole_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR Gaz = CALCULATE(SUM(Fact_Emissions[CO2_gaz_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR Ciment = CALCULATE(SUM(Fact_Emissions[CO2_ciment_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			VAR Torche = CALCULATE(SUM(Fact_Emissions[CO2_torchage_Mt]), Fact_Emissions[Ann√©e] = Annee, Fact_Emissions[Code ISO] = CodePays)
			
			VAR CO2_Total = Charbon + Petrole + Gaz + Ciment + Torche
			
			VAR TableActuelle =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", Charbon),
			        ROW("Secteur", "P√©trole", "Valeur", Petrole),
			        ROW("Secteur", "Gaz", "Valeur", Gaz),
			        ROW("Secteur", "Ciment", "Valeur", Ciment),
			        ROW("Secteur", "Torchage", "Valeur", Torche)
			    )
			
			VAR MaxValeur = MAXX(TableActuelle, [Valeur])
			VAR SecteurActuel = MAXX(FILTER(TableActuelle, [Valeur] = MaxValeur), [Secteur])
			VAR PartActuelle = DIVIDE(MaxValeur, CO2_Total)
			
			// Valeurs ann√©e pr√©c√©dente
			VAR CharbonPrec = CALCULATE(SUM(Fact_Emissions[CO2_charbon_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR PetrolePrec = CALCULATE(SUM(Fact_Emissions[CO2_p√©trole_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR GazPrec = CALCULATE(SUM(Fact_Emissions[CO2_gaz_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR CimentPrec = CALCULATE(SUM(Fact_Emissions[CO2_ciment_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			VAR TorchePrec = CALCULATE(SUM(Fact_Emissions[CO2_torchage_Mt]), REMOVEFILTERS(Dim_Temps), Fact_Emissions[Ann√©e] = AnneePrec, Fact_Emissions[Code ISO] = CodePays)
			
			VAR CO2_TotalPrec = CharbonPrec + PetrolePrec + GazPrec + CimentPrec + TorchePrec
			
			VAR TablePrec =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", CharbonPrec),
			        ROW("Secteur", "P√©trole", "Valeur", PetrolePrec),
			        ROW("Secteur", "Gaz", "Valeur", GazPrec),
			        ROW("Secteur", "Ciment", "Valeur", CimentPrec),
			        ROW("Secteur", "Torchage", "Valeur", TorchePrec)
			    )
			
			VAR MaxPrec = MAXX(TablePrec, [Valeur])
			VAR SecteurPrec = MAXX(FILTER(TablePrec, [Valeur] = MaxPrec), [Secteur])
			VAR PartPrec = DIVIDE(MaxPrec, CO2_TotalPrec)
			
			// Comparaison
			VAR Meme = SecteurActuel = SecteurPrec
			VAR Delta = DIVIDE(PartActuelle - PartPrec, PartPrec)
			
			// Style dynamique
			VAR Signe = IF(ISBLANK(Delta), BLANK(), IF(Delta > 0, "+", "-"))
			VAR Fleche = IF(ISBLANK(Delta), "", IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì")))
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        NOT Meme, "#9F5D35",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			VAR TexteVariation =
			    IF(
			        ISBLANK(SecteurPrec),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        IF(
			            Meme,
			            "<br><span style='color:" & Couleur & "; font-weight:bold;'>" &
			            Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " de sa part vs " & AnneePrec & "</span>",
			            "<br><span style='color:" & Couleur & "; font-weight:bold;'>‚ö† Secteur dominant diff√©rent de " & AnneePrec & "</span>"
			        )
			    )
			
			// Affichage
			RETURN
			IF(
			    ISBLANK(SecteurActuel) || ISBLANK(CO2_Total),
			    "<span style='color:#999999;'>Donn√©es indisponibles</span>",
			    "<div style='font-family:Segoe UI; font-size:13px;'>" &
			    "üè≠ <b>" & SecteurActuel & "</b> est le secteur principal d‚Äô√©mission de CO‚ÇÇ pour <b>" & Pays & "</b> en " & Annee & "<br>" &
			    "<span style='color:#264059;'>Il repr√©sente <b>" & FORMAT(PartActuelle, "0.0%") & "</b> des √©missions sectorielles</span>" &
			    TexteVariation &
			    "</div>"
			)
			
			```
		displayFolder: Focus pays
		lineageTag: bd5845ea-baa7-4691-be7a-72b11655c4a2

	measure Top5_Pollueurs_HTML_Dyn = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			VAR TableCO2 =
			    ADDCOLUMNS(
			        SUMMARIZE(
			            Fact_Emissions,
			            Fact_Emissions[Code ISO],
			            "Pays", MAX(Dim_Pays[Pays]),
			            "ISO", MAX(Dim_Pays[Code ISO])
			        ),
			        "TotalCO2",
			            CALCULATE(
			                SUM(Fact_Emissions[CO2_total_Mt]) * 1000000,
			                Fact_Emissions[Ann√©e] = Annee,
			                REMOVEFILTERS(Dim_Pays)
			            )
			    )
			
			VAR TableTop =
			    TOPN(5, TableCO2, [TotalCO2], DESC)
			
			VAR TableFinal =
			    ADDCOLUMNS(
			        TableTop,
			        "Rang", RANKX(TableCO2, [TotalCO2], , DESC),
			        "Drapeau", IF(LEN([ISO]) = 2, UNICHAR(127397 + UNICODE(LEFT([ISO], 1))) & UNICHAR(127397 + UNICODE(RIGHT([ISO], 1))), ""),
			        "TexteCO2", IF([TotalCO2] >= 1000000, FORMAT([TotalCO2] / 1000000, "#,##0.0") & " Mt", FORMAT([TotalCO2], "#,##0") & " t")
			    )
			
			VAR Htmliso =
			    CONCATENATEX(
			        TableFinal,
			        "<tr><td>" & [Rang] & ". " & [Drapeau] & " " & [Pays] & "</td><td align='right' style='color:#E5690B;'>" & [TexteCO2] & "</td></tr>",
			        UNICHAR(10),
			        [Rang], ASC
			    )
			
			RETURN
			"
			<div style='font-family:Segoe UI; font-size:15px;'>
			  <div style='color:#E5690B; font-weight:bold; font-size:18px; margin-bottom:8px;'>
			    üî∫ Top 5 des pays les plus √©metteurs de CO‚ÇÇ 
			    <span style='color:#264059; font-size:18px;'>(" & Annee & ")</span>
			  </div>
			  <table style='width:100%; border-collapse:collapse;'>" & Htmliso & "</table>
			</div>"
			
			```
		displayFolder: Focus pays
		lineageTag: e9a7a277-807d-4d7e-8395-5fdcdbcbfc3d

	measure Top5_MoinsEmetteurs_HTML_Dyn = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			// Table des √©missions par pays (en tonnes)
			VAR TableCO2 =
			    ADDCOLUMNS(
			        SUMMARIZE(
			            Fact_Emissions,
			            Fact_Emissions[Code ISO],
			            "Pays", MAX(Dim_Pays[Pays]),
			            "ISO", MAX(Dim_Pays[Code ISO])
			        ),
			        "TotalCO2",
			            CALCULATE(
			                SUM(Fact_Emissions[CO2_total_Mt]) * 1000000,
			                Fact_Emissions[Ann√©e] = Annee,
			                REMOVEFILTERS(Dim_Pays)
			            )
			    )
			
			// Garder uniquement les pays avec CO2 > 0
			VAR TableFiltre =
			    FILTER(TableCO2, [TotalCO2] > 0)
			
			// R√©cup√©rer les 5 plus petits √©metteurs
			VAR TableBottom5 =
			    TOPN(5, TableFiltre, [TotalCO2], ASC)
			
			// Ajouter rang et format
			VAR TableFinal =
			    ADDCOLUMNS(
			        TableBottom5,
			        "Rang", RANKX(TableBottom5, [TotalCO2], , ASC),
			        "Drapeau", IF(LEN([ISO]) = 2, UNICHAR(127397 + UNICODE(LEFT([ISO], 1))) & UNICHAR(127397 + UNICODE(RIGHT([ISO], 1))), ""),
			        "TexteCO2", IF([TotalCO2] >= 1000000, FORMAT([TotalCO2] / 1000000, "#,##0.0") & " Mt", FORMAT([TotalCO2], "#,##0") & " t")
			    )
			
			// G√©n√©ration du HTML tri√© par rang
			VAR Htmlco2 =
			    CONCATENATEX(
			        TableFinal,
			        "<tr><td>" & [Rang] & ". " & [Drapeau] & " " & [Pays] & "</td><td align='right' style='color:#5CB85C;'>" & [TexteCO2] & "</td></tr>",
			        UNICHAR(10),
			        [Rang], ASC
			    )
			
			// Bloc final
			RETURN
			"
			<div style='font-family:Segoe UI; font-size:15px;'>
			  <div style='color:#5CB85C; font-weight:bold; font-size:18px; margin-bottom:8px;'>
			    üü¢ Top 5 des pays les moins √©metteurs de CO‚ÇÇ 
			    <span style='color:#264059; font-size:18px;'>(" & Annee & ")</span>
			  </div>
			  <table style='width:100%; border-collapse:collapse;'>" & Htmlco2 & "</table>
			</div>"
			
			```
		displayFolder: Focus pays
		lineageTag: f303a8ef-9c5d-470a-84f2-ef70af13ab75

	measure KPI_CO2_total_Mt = ```
			
			SUM(Fact_Emissions[CO2_total_Mt])
			
			```
		displayFolder: Focus GAZ
		lineageTag: 4cbdd5e6-cee2-4c25-830f-86966ff1fc8c

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	measure KPI_CH4_total_Mt = ```
			
			SUM(Fact_Emissions[M√©thane_Mt])
			
			```
		displayFolder: Focus GAZ
		lineageTag: c890c9c2-749a-42e1-b462-62b828505fb0

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	measure KPI_N2O_total_Mt = ```
			
			SUM(Fact_Emissions[N2O_Mt])
			
			```
		displayFolder: Focus GAZ
		lineageTag: 292962d0-a671-424a-b388-c6f620b64996

		annotation PBI_FormatHint = {"isGeneralNumber":true}

	measure Bloc_Narratif_Par_Gaz = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			VAR CO2 = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR CH4 = CALCULATE(SUM(Fact_Emissions[M√©thane_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR N2O = CALCULATE(SUM(Fact_Emissions[N2O_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR GES = CALCULATE(SUM(Fact_Emissions[GES_total_Mt]), Fact_Emissions[Ann√©e] = Annee)
			
			VAR Pct_CO2 = DIVIDE(CO2, GES)
			VAR Pct_CH4 = DIVIDE(CH4, GES)
			VAR Pct_N2O = DIVIDE(N2O, GES)
			
			RETURN
			"
			<div style='font-family:Segoe UI; font-size:15px; line-height:1.6;'>
			  <div style='font-size:18px; font-weight:bold; color:#264059; margin-bottom:6px;'>
			    üí¨ Que peut-on retenir des √©missions de gaz √† effet de serre en " & Annee & " ?
			  </div>
			
			  <p style='margin:0 0 8px 0;'>üåç Le <span style='color:#E5690B; font-weight:bold;'>CO‚ÇÇ</span> reste le principal gaz √©mis, repr√©sentant <b>" & FORMAT(Pct_CO2, "0 %") & "</b> des √©missions mondiales.</p>
			
			  <p style='margin:0 0 8px 0;'>üü¢ Le <span style='color:#5CB85C; font-weight:bold;'>m√©thane (CH‚ÇÑ)</span>, souvent sous-estim√©, repr√©sente <b>" & FORMAT(Pct_CH4, "0 %") & "</b> ‚Äî alors qu‚Äôil est 80 fois plus r√©chauffant que le CO‚ÇÇ sur 20 ans.</p>
			
			  <p style='margin:0 0 8px 0;'>üîµ Le <span style='color:#6EA0B1; font-weight:bold;'>protoxyde d‚Äôazote (N‚ÇÇO)</span> compl√®te le trio avec <b>" & FORMAT(Pct_N2O, "0 %") & "</b>, et a un pouvoir de r√©chauffement pr√®s de 300 fois sup√©rieur au CO‚ÇÇ.</p>
			
			  <p style='margin:0;'>‚ö†Ô∏è Tous les gaz ne se valent pas : <span style='color:#E5690B;'>r√©duire uniquement le CO‚ÇÇ ne suffit pas</span>.</p>
			</div>"
			
			```
		displayFolder: Focus GAZ
		lineageTag: ecb1da8c-9d4a-40b3-aa59-123e726baa8b

	measure Bloc_Boutons_Onglets_Gaz = ```
			
			"
			<div style='font-family:Segoe UI; font-size:14px; display:flex; gap:12px; margin:10px 0;'>
			
			  <div style='cursor:pointer; background:#E5690B; padding:8px 16px; border-radius:20px; color:white; font-weight:bold;' onclick=""window.PowerBIBookmarks.activateBookmark('Gaz_CO2')"">
			    üåç CO‚ÇÇ
			  </div>
			
			  <div style='cursor:pointer; background:#5CB85C; padding:8px 16px; border-radius:20px; color:white; font-weight:bold;' onclick=""window.PowerBIBookmarks.activateBookmark('Gaz_CH4')"">
			    üå± CH‚ÇÑ
			  </div>
			
			  <div style='cursor:pointer; background:#6EA0B1; padding:8px 16px; border-radius:20px; color:white; font-weight:bold;' onclick=""window.PowerBIBookmarks.activateBookmark('Gaz_N2O')"">
			    üí® N‚ÇÇO
			  </div>
			
			</div>
			"
			
			```
		displayFolder: Focus GAZ
		lineageTag: 6e7f80f7-1bfb-4cfc-b4bd-24825de2ca6a

	measure Titre_Impactant_Accueil = ```
			
			"
			<div style='font-family:Segoe UI; padding:9px;'>
			  <div style='font-size:40px; font-weight:bold; color:#E5690B;'>
			    üî• Plus chaud, Plus vite, Plus dangereux!
			  </div>
			  <div style='margin-top:6px; font-size:15px; color:#264059; line-height:1.5;'>
			    Les √©missions mondiales ne ralentissent pas.<br>
			    Le m√©thane, le CO‚ÇÇ et le N‚ÇÇO s‚Äôaccumulent‚Ä¶ <b>et le temps presse.</b>
			  </div>
			</div>"
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: 4de6d21d-dccd-4cdb-abdd-a6fc1a13f129

	measure Score_Climatique_HTML = ```
			
			"
			<div style='font-family:Segoe UI; font-size:8px; padding:0px;'>
			  <div style='font-size:15px; font-weight:bold; color:#264059; margin-bottom:5px;'>üìä Score climatique mondial</div>
			  <ul style='list-style:none; padding-left:0; line-height:1.8;'>
			    <li>üìà <b>Tendance des √©missions :</b> <span style='color:#E5690B;'>en hausse</span></li>
			    <li>üî• <b>Gaz dominant :</b> CO‚ÇÇ (76%)</li>
			    <li>üß™ <b>Gaz les plus puissants :</b> CH‚ÇÑ (80x), N‚ÇÇO (300x)</li>
			    <li>‚ùå <b>Objectif 1,5¬∞C :</b> non respect√©</li>
			  </ul>
			</div>"
			
			```
		displayFolder: Vue d'ensemble
		lineageTag: 5ce90c10-118c-452c-b4b4-6ab075a31b1c

	measure HTML_Score_Pays_Climatique = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			
			// Valeurs brutes
			VAR CO2 = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Code ISO] = CodePays, Fact_Emissions[Ann√©e] = Annee)
			VAR Pop = CALCULATE(SUM(Fact_Emissions[Population]), Fact_Emissions[Code ISO] = CodePays,  Fact_Emissions[Ann√©e] = Annee)
			VAR GES = CALCULATE(SUM(Fact_Emissions[GES_total_Mt]), Fact_Emissions[Code ISO] = CodePays,  Fact_Emissions[Ann√©e] = Annee)
			VAR CO2_par_hab = DIVIDE(CO2 * 1000000, Pop)
			
			// Rang mondial CO2
			VAR Rang =
			    RANKX(
			        CALCULATETABLE(
			            SUMMARIZE(Fact_Emissions, Fact_Emissions[Code ISO]),
			            ALL(Dim_Pays),
			            KEEPFILTERS(Fact_Emissions[Ann√©e] = SELECTEDVALUE(Dim_Temps[Ann√©e]))
			        ),
			        CALCULATE(SUM(Fact_Emissions[CO2_total_Mt])),
			        ,
			        DESC
			    )
			
			// Gaz dominant
			VAR CH4 = CALCULATE(SUM(Fact_Emissions[M√©thane_Mt]), Fact_Emissions[Code ISO] = CodePays,  Fact_Emissions[Ann√©e] = Annee)
			VAR N2O = CALCULATE(SUM(Fact_Emissions[N2O_Mt]), Fact_Emissions[Code ISO] = CodePays,  Fact_Emissions[Ann√©e] = Annee)
			
			VAR GazDom =
			    SWITCH(
			        TRUE(),
			        CO2 >= CH4 && CO2 >= N2O, "CO‚ÇÇ",
			        CH4 >= CO2 && CH4 >= N2O, "CH‚ÇÑ",
			        "N‚ÇÇO"
			    )
			
			VAR Couleur =
			    SWITCH(GazDom,
			        "CO‚ÇÇ", "#E5690B",
			        "CH‚ÇÑ", "#5CB85C",
			        "N‚ÇÇO", "#6EA0B1",
			        "#264059"
			    )
			
			RETURN
			IF(
			    ISBLANK(Pays),
			    "<div style='font-family:Segoe UI; font-size:14px; color:#888;'>S√©lectionnez un pays pour afficher son profil climatique</div>",
			"
			<div style='font-family:Segoe UI; font-size:15px; line-height:1.7;'>
			  <div style='font-size:15px; font-weight:bold; color:#264059; margin-bottom:8px;'>üìç Profil climatique de " & Pays & " (" & Annee & ")</div>
			  <ul style='list-style:none; padding-left:0; line-height:1.8;'>
			    <li>üå´Ô∏è <b>√âmissions totales :</b> " & FORMAT(GES, "0.0") & " Mt</li>
			    <li>üë§ <b>CO‚ÇÇ par habitant :</b> " & FORMAT(CO2_par_hab, "0.0") & " t/hab</li>
			    <li>üèÜ <b>Rang mondial :</b> " & Rang & "·µâ √©metteur de CO‚ÇÇ</li>
			    <li>üß™ <b>Gaz dominant :</b> <span style='color:" & Couleur & "; font-weight:bold;'>" & GazDom & "</span></li>
			  </ul>
			</div>"
			)
			
			```
		displayFolder: Focus pays
		lineageTag: b0fd59b1-9cca-4cd4-8c09-8ac55593b71a

	measure HTML_Score_Gaz_Monde = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			// Sommes mondiales
			VAR CO2 = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR CH4 = CALCULATE(SUM(Fact_Emissions[M√©thane_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR N2O = CALCULATE(SUM(Fact_Emissions[N2O_Mt]), Fact_Emissions[Ann√©e] = Annee)
			VAR GES_Total = CO2 + CH4 + N2O
			
			// Pourcentages
			VAR Pct_CO2 = DIVIDE(CO2, GES_Total)
			VAR Pct_CH4 = DIVIDE(CH4, GES_Total)
			VAR Pct_N2O = DIVIDE(N2O, GES_Total)
			
			// Gaz dominant
			VAR GazDom =
			    SWITCH(
			        TRUE(),
			        CO2 >= CH4 && CO2 >= N2O, "CO‚ÇÇ",
			        CH4 >= CO2 && CH4 >= N2O, "CH‚ÇÑ",
			        "N‚ÇÇO"
			    )
			
			VAR Couleur =
			    SWITCH(GazDom,
			        "CO‚ÇÇ", "#E5690B",
			        "CH‚ÇÑ", "#5CB85C",
			        "N‚ÇÇO", "#6EA0B1",
			        "#264059"
			    )
			
			// Bloc HTML
			RETURN
			"
			<div style='font-family:Segoe UI; font-size:15px; line-height:1;'>
			  <div style='font-size:15px; font-weight:bold; color:#264059; margin-bottom:2px;'>üìä R√©partition mondiale des gaz √† effet de serre (" & Annee & ")</div>
			  <ul style='list-style:none; padding-left:0; line-height:1;'>
			    <li>üü† <b>CO‚ÇÇ :</b> " & FORMAT(Pct_CO2, "0 %") & "</li>
			    <li>üü¢ <b>CH‚ÇÑ (M√©thane) :</b> " & FORMAT(Pct_CH4, "0 %") & "</li>
			    <li>üîµ <b>N‚ÇÇO :</b> " & FORMAT(Pct_N2O, "0 %") & "</li>
			  </ul>
			  <div style='margin-top:6px;'>Le gaz dominant cette ann√©e est : <b style='color:" & Couleur & ";'>" & GazDom & "</b>.</div>
			</div>"
			
			```
		displayFolder: Focus GAZ
		lineageTag: f5cfc3c3-e0de-4a92-8c3f-76503d16abc6

	measure Titre_Dynamique_Gaz3 = ```
			
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			RETURN
			    IF(
			        ISBLANK(Pays),
			        "üìä √âvolution mondiale des √©missions de CO‚ÇÇ, CH‚ÇÑ et N‚ÇÇO",
			        "üìä √âvolution des √©missions de CO‚ÇÇ, CH‚ÇÑ et N‚ÇÇO en " & Pays
			    )
			
			```
		displayFolder: Focus GAZ
		lineageTag: 44e1e73f-b337-4d16-9b9d-e6f197731199

	measure HTML_Score_Secteurs = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			// Valeurs sectorielles globales
			VAR Charbon = SUM(Fact_Emissions[CO2_charbon_Mt])
			VAR Petrole = SUM(Fact_Emissions[CO2_p√©trole_Mt])
			VAR Gaz = SUM(Fact_Emissions[CO2_gaz_Mt])
			VAR Ciment = SUM(Fact_Emissions[CO2_ciment_Mt])
			VAR Torche = SUM(Fact_Emissions[CO2_torchage_Mt])
			VAR Total = Charbon + Petrole + Gaz + Ciment + Torche
			
			// Table des secteurs (dynamiquement cr√©√©e)
			VAR TableSecteurs =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", Charbon),
			        ROW("Secteur", "P√©trole", "Valeur", Petrole),
			        ROW("Secteur", "Gaz", "Valeur", Gaz),
			        ROW("Secteur", "Ciment", "Valeur", Ciment),
			        ROW("Secteur", "Torchage", "Valeur", Torche)
			    )
			
			// Secteur dominant
			VAR SecteurDom =
			    MAXX(
			        TOPN(1, TableSecteurs, [Valeur], DESC),
			        [Secteur]
			    )
			
			// Couleur dynamique
			VAR Couleur =
			    SWITCH(SecteurDom,
			        "Charbon", "#E5690B",
			        "P√©trole", "#9F5D35",
			        "Gaz", "#6EA0B1",
			        "Ciment", "#5CB85C",
			        "Torchage", "#A569BD",
			        "#264059"
			    )
			
			// Bloc HTML
			RETURN
			"
			<div style='font-family:Segoe UI; font-size:14px; line-height:1.3;'>
			  <div style='font-weight:bold; color:#264059; font-size:13px;'>üì¶ R√©partition des √©missions par secteur (" & Annee & ")</div>
			  <ul style='list-style:none; padding-left:0;'>
			    <li>üß± <b>Charbon :</b> " & FORMAT(Charbon, "0.0") & " Mt</li>
			    <li>üõ¢ <b>P√©trole :</b> " & FORMAT(Petrole, "0.0") & " Mt</li>
			    <li>üî• <b>Gaz :</b> " & FORMAT(Gaz, "0.0") & " Mt</li>
			    <li>üèó <b>Ciment :</b> " & FORMAT(Ciment, "0.0") & " Mt</li>
			    <li>üö® <b>Torchage :</b> " & FORMAT(Torche, "0.0") & " Mt</li>
			    <li>üéØ Le secteur dominant est le : <b style='color:" & Couleur & ";'>" & SecteurDom & "</b></li>
			  </ul>
			  
			</div>"
			
			```
		displayFolder: Focus Secteur
		lineageTag: 874aff13-5cfe-4e30-a9f2-09e46d9bcb9a

	measure HTML_KPI_CO2_Charbon_YoY = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles et pr√©c√©dentes
			VAR Valeur = CALCULATE(
			    SUM(Fact_Emissions[CO2_charbon_Mt]),
			    Fact_Emissions[Ann√©e] = Annee
			)
			
			VAR ValeurPrec = CALCULATE(
			    SUM(Fact_Emissions[CO2_charbon_Mt]),
			    REMOVEFILTERS(Dim_Temps),
			    Fact_Emissions[Ann√©e] = AnneePrec
			)
			
			// Variation %
			VAR Delta = DIVIDE(Valeur - ValeurPrec, ValeurPrec)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",
			        ABS(Delta) < 0.001, "#999999",
			        Delta < 0, "#5CB85C",
			        Delta > 0, "#E5690B",
			        "#999999"
			    )
			
			VAR TexteVariation =
			    IF(ISBLANK(Delta),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Affichage final
			RETURN
			"<div style='font-family:Segoe UI; font-size:15px;'>
			  üß± √âmissions li√©es au charbon en " & Annee & " : <b>" & FORMAT(Valeur, "0.0") & " Mt</b><br>
			  " & TexteVariation & "
			</div>"
			
			```
		displayFolder: Focus Secteur
		lineageTag: f0619616-710a-4691-9511-975f0b3c39b1

	measure HTML_KPI_CO2_Petrole_YoY = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles et pr√©c√©dentes
			VAR Valeur = CALCULATE(
			    SUM(Fact_Emissions[CO2_p√©trole_Mt]),
			    Fact_Emissions[Ann√©e] = Annee
			)
			
			VAR ValeurPrec = CALCULATE(
			    SUM(Fact_Emissions[CO2_p√©trole_Mt]),
			    REMOVEFILTERS(Dim_Temps),
			    Fact_Emissions[Ann√©e] = AnneePrec
			)
			
			// Variation %
			VAR Delta = DIVIDE(Valeur - ValeurPrec, ValeurPrec)
			
			// Style dynamique
			VAR Signe =
			    IF(ISBLANK(Delta), BLANK(),
			        IF(ABS(Delta) < 0.001, "", IF(Delta > 0, "+", "-"))
			    )
			
			VAR Fleche =
			    IF(ISBLANK(Delta), "",
			        IF(ABS(Delta) < 0.001, "‚Üí", IF(Delta > 0, "‚Üë", "‚Üì"))
			    )
			
			VAR Couleur =
			    SWITCH(TRUE(),
			        ISBLANK(Delta), "#999999",         // pas de donn√©es
			        ABS(Delta) < 0.001, "#999999",     // stable
			        Delta < 0, "#5CB85C",              // baisse = bon ‚Üí vert
			        Delta > 0, "#E5690B",              // hausse = mauvais ‚Üí orange
			        "#999999"
			    )
			
			VAR VariationTexte =
			    IF(ISBLANK(Delta),
			        "<span style='color:#999999;'>Donn√©es insuffisantes</span>",
			        "<span style='color:" & Couleur & "; font-weight:bold;'>" &
			        Fleche & " " & Signe & FORMAT(ABS(Delta), "0.0%") & " par rapport √† " & AnneePrec & "</span>"
			    )
			
			// Bloc HTML final
			RETURN
			"<div style='font-family:Segoe UI; font-size:15px;'>
			  üõ¢ √âmissions li√©es au p√©trole en " & Annee & " : <b>" & FORMAT(Valeur, "0.0") & " Mt</b><br>
			  " & VariationTexte & "
			</div>"
			
			```
		displayFolder: Focus Secteur
		lineageTag: e34a8ea6-2b52-4560-b25d-c67ff94704e1

	measure HTML_KPI_SecteurDominant_YoY = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR AnneePrec = Annee - 1
			
			// Valeurs actuelles
			VAR SecteursActuel =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", SUM(Fact_Emissions[CO2_charbon_Mt])),
			        ROW("Secteur", "P√©trole", "Valeur", SUM(Fact_Emissions[CO2_p√©trole_Mt])),
			        ROW("Secteur", "Gaz", "Valeur", SUM(Fact_Emissions[CO2_gaz_Mt])),
			        ROW("Secteur", "Ciment", "Valeur", SUM(Fact_Emissions[CO2_ciment_Mt])),
			        ROW("Secteur", "Torchage", "Valeur", SUM(Fact_Emissions[CO2_torchage_Mt]))
			    )
			VAR SecteurActuel = MAXX(TOPN(1, SecteursActuel, [Valeur], DESC), [Secteur])
			
			// Valeurs pr√©c
			VAR SecteursPrec =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", CALCULATE(SUM(Fact_Emissions[CO2_charbon_Mt]), Fact_Emissions[Ann√©e] = AnneePrec)),
			        ROW("Secteur", "P√©trole", "Valeur", CALCULATE(SUM(Fact_Emissions[CO2_p√©trole_Mt]), Fact_Emissions[Ann√©e] = AnneePrec)),
			        ROW("Secteur", "Gaz", "Valeur", CALCULATE(SUM(Fact_Emissions[CO2_gaz_Mt]), Fact_Emissions[Ann√©e] = AnneePrec)),
			        ROW("Secteur", "Ciment", "Valeur", CALCULATE(SUM(Fact_Emissions[CO2_ciment_Mt]), Fact_Emissions[Ann√©e] = AnneePrec)),
			        ROW("Secteur", "Torchage", "Valeur", CALCULATE(SUM(Fact_Emissions[CO2_torchage_Mt]), Fact_Emissions[Ann√©e] = AnneePrec))
			    )
			VAR SecteurPrec = MAXX(TOPN(1, SecteursPrec, [Valeur], DESC), [Secteur])
			
			VAR Variation =
			    IF(
			        SecteurActuel = SecteurPrec,
			        "‚úÖ Secteur dominant inchang√© (" & SecteurActuel & ")",
			        "‚ö† Changement de secteur dominant : <b>" & SecteurPrec & "</b> ‚Üí <b>" & SecteurActuel & "</b>"
			    )
			
			RETURN
			"<div style='font-family:Segoe UI; font-size:15px;'>
			  üß≠ Secteur dominant en " & Annee & " : <b>" & SecteurActuel & "</b><br>
			  " & Variation & "
			</div>"
			
			```
		displayFolder: Focus Secteur
		lineageTag: 8da216ef-4bd3-4270-8ebe-b57b13fd2fab

	measure HTML_KPI_Top3_Secteurs = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			
			VAR TableSecteurs =
			    UNION(
			        ROW("Secteur", "Charbon", "Valeur", SUM(Fact_Emissions[CO2_charbon_Mt])),
			        ROW("Secteur", "P√©trole", "Valeur", SUM(Fact_Emissions[CO2_p√©trole_Mt])),
			        ROW("Secteur", "Gaz", "Valeur", SUM(Fact_Emissions[CO2_gaz_Mt])),
			        ROW("Secteur", "Ciment", "Valeur", SUM(Fact_Emissions[CO2_ciment_Mt])),
			        ROW("Secteur", "Torchage", "Valeur", SUM(Fact_Emissions[CO2_torchage_Mt]))
			    )
			
			VAR Top3 =
			    TOPN(3, TableSecteurs, [Valeur], DESC)
			
			VAR HtmlList =
			    CONCATENATEX(
			        Top3,
			        "<li><b>" & [Secteur] & "</b> : " & FORMAT([Valeur], "0.0") & " Mt</li>",
			        UNICHAR(10)
			    )
			
			RETURN
			"<div style='font-family:Segoe UI; font-size:10px;'>
			  ü•á Les 3 secteurs les plus √©metteurs en " & Annee & " :
			  <ul style='padding-left:4px;'>" & HtmlList & "</ul>
			</div>"
			
			```
		displayFolder: Focus Secteur
		lineageTag: be5b65e5-236f-4643-9d71-33cc05df4f11

	measure Titre_Graph_Charbon = ```
			
			VAR Annee = MAX(Dim_Temps[Ann√©e])
			VAR Pays = SELECTEDVALUE(Dim_Pays[Pays])
			
			RETURN
			IF(
			    ISBLANK(Pays),
			    "üìà √âvolution des √©missions des secteurs  jusqu‚Äôen " & Annee,
			    "üìà √âvolution des √©missions des secteurs  en " & Pays & " jusqu‚Äôen " & Annee
			)
			
			```
		displayFolder: Focus Secteur
		lineageTag: d977af3c-440a-4fe4-adbd-be42d6755ce5

	measure Tooltip_CO2_par_Habitant_HTML = ```
			
			VAR Annee = SELECTEDVALUE(Dim_Temps[Ann√©e])
			VAR CodePays = SELECTEDVALUE(Dim_Pays[Code ISO])
			VAR NomPays = SELECTEDVALUE(Dim_Pays[Pays])
			
			// Pays (actuels)
			VAR CO2_Pays = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]) * 1000000)
			VAR Pop_Pays = CALCULATE(SUM(Fact_Emissions[Population]))
			VAR RatioPays = DIVIDE(CO2_Pays, Pop_Pays)
			
			// Monde (global)
			VAR CO2_Monde = CALCULATE(SUM(Fact_Emissions[CO2_total_Mt]) * 1000000, REMOVEFILTERS(Dim_Pays))
			VAR Pop_Monde = CALCULATE(SUM(Fact_Emissions[Population]), REMOVEFILTERS(Dim_Pays))
			VAR RatioMonde = DIVIDE(CO2_Monde, Pop_Monde)
			
			// Part du pays dans les √©missions mondiales
			VAR PartCO2 = DIVIDE(CO2_Pays, CO2_Monde)
			
			// Format
			VAR CO2_Mt = FORMAT(CO2_Pays / 1000000, "0.0")
			VAR Pop_Millions = FORMAT(Pop_Pays / 1000000, "0.0")
			VAR PartCO2_Pourcent = FORMAT(PartCO2, "0.0%")
			
			// Badge & Slogan
			VAR RatioRelatif = DIVIDE(RatioPays, RatioMonde)
			
			VAR Badge =
			    SWITCH(TRUE(),
			        ISBLANK(CodePays), "",
			        RatioPays < 1, "<span style='color:#5CB85C;'>üü¢ Faible √©metteur</span>",
			        RatioPays < 5, "<span style='color:#F0AD4E;'>üü† <b>√âmetteur moyen</span> </b>",
			        "<span style='color:#D9534F;'>üî¥ √âmetteur √©lev√©</span>"
			    )
			
			VAR Slogan =
			    SWITCH(TRUE(),
			        ISBLANK(CodePays), "",
			        RatioRelatif >= 10, "üí• Ce pays √©met plus de <b>10√ó</b> la moyenne mondiale.",
			        RatioRelatif >= 5, "‚ö†Ô∏è Ce pays d√©passe <b>5√ó</b> la moyenne mondiale.",
			        RatioRelatif <= 0.5, "‚úÖ Ce pays √©met <b>2√ó moins</b> que la moyenne.",
			        ""
			    )
			
			VAR Conclu =
			    SWITCH(TRUE(),
			        ISBLANK(CodePays), "",
			        RatioPays >= 15, "üåç Un poids lourd du carbone",
			        RatioPays <= 1, "üå± Un exemple de sobri√©t√©",
			        ""
			    )
			
			// Texte quand pays s√©lectionn√©
			VAR TextePays =
			"<div style='font-family:Segoe UI; font-size:13px; line-height:2;'>
			  <div style='font-weight:bold; font-size:18px; color:#264059; margin-bottom:4px;'>üìç Profil CO‚ÇÇ de " & NomPays & " (" & Annee & ")</div>
			  <ul style='padding-left:0; list-style:none; line-height:2;'>
			    <li>üë§ <b>" & FORMAT(RatioPays, "0.0") & " t</b> de CO‚ÇÇ par habitant</li>
			    <li>üåç Moyenne mondiale : <b>" & FORMAT(RatioMonde, "0.0") & " t/hab</b></li>
			    <li>" & Badge & "</li>
			    <li>üßÆ Total : <b>" & CO2_Mt & " Mt</b> de CO‚ÇÇ</li>
			    <li>üë• Population : <b>" & Pop_Millions & " M</b> d‚Äôhabitants</li>
			    <li>üìä Part mondiale : <b>" & PartCO2_Pourcent & "</b> des √©missions</li>
			  </ul>
			  <div style='margin-top:4px; font-style:italic;'>" & Slogan & "<br>" & Conclu & "</div>
			</div>"
			
			// Texte mondial si aucun pays s√©lectionn√©
			VAR TexteMonde =
			"<div style='font-family:Segoe UI; font-size:13px; line-height:2.5;'>
			  <div style='font-weight:bold; font-size:14px; color:#264059;'>üåç Monde (" & Annee & ")</div>
			  üë§ <b>" & FORMAT(RatioMonde, "0.0") & " t</b> de CO‚ÇÇ par habitant en moyenne<br>
			  üßÆ <b>" & FORMAT(CO2_Monde / 1000000, "0.0") & " Mt</b> √©mis au total<br>
			  üë• <b>" & FORMAT(Pop_Monde / 1000000, "0") & " M</b> d‚Äôhabitants
			</div>"
			
			// Retour
			RETURN
			IF(ISBLANK(CodePays), TexteMonde, TextePays)
			
			```
		displayFolder: In√©galit√©s
		lineageTag: 4b6967c3-5137-4e0c-a2e2-d427e951ba56

	column Column
		isHidden
		formatString: 0
		lineageTag: 6f03e617-5914-4172-938b-9e3ca61b5cee
		summarizeBy: sum
		isNameInferred
		sourceColumn: [Column]

		annotation SummarizationSetBy = Automatic

	partition __MESURES = calculated
		mode: import
		source = Row("Column", BLANK())

	annotation PBI_Id = 70e20b66a18d48f2b400c650d6fd7c90

	annotation 436ba87b-9c83-4389-a31b-ebd06a36be98 = {"Expression":""}

